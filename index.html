<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little X and Cosmic Codes - Book 4</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #000428 0%, #004e92 50%, #1a1a2e 100%);
            color: white;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite alternate;
        }
        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.2); }
        }
        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(1.5); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        @keyframes guest-pop {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            text-shadow: 0 0 20px #00ffff;
            animation: glow 2s ease-in-out infinite alternate;
            margin-bottom: 10px;
        }
        @keyframes glow {
            from { text-shadow: 0 0 20px #00ffff; }
            to { text-shadow: 0 0 30px #00ffff, 0 0 40px #8a2be2; }
        }
        .chapter {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00ffff;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            line-height: 1.8;
        }
        .chapter h2 {
            color: #00ffff;
            margin-top: 0;
        }
        .chalkboard-container {
            background: rgba(0, 255, 255, 0.2);
            border: 3px dashed #00ffff;
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
            position: relative;
        }
        .btn {
            background: linear-gradient(45deg, #00ffff, #8a2be2);
            border: none;
            color: #000;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 255, 255, 0.5);
        }
        .code-block {
            display: inline-block;
            background: linear-gradient(45deg, #ff6b9d, #8a2be2);
            padding: 10px 15px;
            border-radius: 10px;
            cursor: grab;
            font-weight: bold;
            margin: 5px;
            border: 2px solid #fff;
            transition: transform 0.2s;
        }
        .code-block:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.8);
        }
        .code-block:active {
            cursor: grabbing;
        }
        .controls, .instruments {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .story-text {
            font-size: 18px;
            margin: 20px 0;
        }
        .character-speech {
            background: rgba(0, 255, 255, 0.1);
            border-left: 4px solid #00ffff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .guest-chat {
            background: rgba(138, 43, 226, 0.1);
            border-left: 4px solid #8a2be2;
            animation: guest-pop 1s ease-out;
        }
        .nav-buttons {
            text-align: center;
            margin: 30px 0;
        }
        @media (max-width: 600px) {
            h1 { font-size: 2em; }
            .chapter { padding: 20px; }
        }
    </style>
</head>
<body>
    <div id="stars-container"></div>
    
    <div class="container">
        <h1>üíª Little X and Cosmic Codes üíª</h1>
        <p style="text-align: center; font-size: 1.2em; color: #00ffff;">Book 4 of the Little X Adventures</p>
        
        <div class="chapter">
            <h2>Chapter 1: Web Wizards ‚Äì Code the Clean Spell!</h2>
            
            <div class="story-text">
                <p>The workshop whooshed and transformed into a glowing code cave, full of bouncy blocks and starry screens! Twirly Logic Fairy ARIA spun in on a pixel tornado, her wings flashing rainbow if-thens.</p>
                
                <div class="character-speech">
                    <strong>Twirly Logic Fairy ARIA:</strong> "Twirl-a-whirl! Codes are giggle-spells for fixing the universe! Deductive? 'If smoky dragon puff, THEN zap with green goo-gone!' Zoom‚Äîproblem poofed! Inductive? 'Feather crumb, feather crumb... ooh, pattern wiggle! Predict the next feather flop!' Spotty-sparky fun!"
                </div>
                
                <p>Little X clapped excitedly. "Like Book 3's web zaps, but with blocky magic?"</p>
                
                <div class="character-speech">
                    <strong>Boomy Block Basher Raaarrr:</strong> "Raaarrr-boom! I'll bash blocks... oopsie-crash! Hee-hee, that's why we TEST‚Äîcodes wiggle wrong sometimes, but fix 'em with hero hearts! Dragons code smoky cheats for their gold giggles, but WE code clean rivers for fishy tickles. No grumpy smashes‚Äîjust wiggly wins for the whole web crew!"
                </div>
                
                <div class="character-speech">
                    <strong>Hooty Hacker Socrates:</strong> "Hooty-hint! Reason's the real wizard wand‚Äîflexy like a vine, not stiff like a grumpy stick. Code to outwit the puffs: Heavy yuck in air? Filter it fair! Water goo? Swirl it pure! Governments sometimes nap on dragon watch, but YOU code the wake-up sparkle. Play‚Äîand learn why 'why' beats 'what-if' every time!"
                </div>
                
                <p>Raaarrr bashed a holographic block (gently), and sparkles flew everywhere. "Ready to spell-cast? Drag blocks to the web, run the code, and watch the magic mend!"</p>
            </div>
            
            <div class="chalkboard-container">
                <h3>üßô Drag & Dash: Code Your Clean-Up!</h3>
                <p>Drag code blocks to the canvas (or arrow-keys to nudge). Deductive mode: Snap rules to zap spots. Inductive: Hunt patterns to predict fixes! 45-second timer‚Äîdash to run before tick-tock!</p>
                <canvas id="code-canvas" width="600" height="400" style="background: linear-gradient(to bottom, #000428, #004e92); border: 2px solid #8a2be2; border-radius: 10px; cursor: crosshair; display: block; margin: 20px auto;"></canvas>
                <div id="code-timer" style="font-size: 24px; color: #ff6b9d; margin: 10px 0;">Time: 45s ‚è∞ ‚Äì Pick a mode!</div>
                <div class="instruments" style="gap: 15px; justify-content: center;">
                    <button class="btn" onclick="startCodeDash('deductive')">üßô Deductive Zap!</button>
                    <button class="btn" onclick="startCodeDash('inductive')">üîÆ Inductive Wiggle!</button>
                </div>
                <div id="code-blocks" style="margin: 15px 0; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                    <div class="code-block" draggable="true" data-type="if-smoky">If Smoky Puff ‚û°Ô∏è Zap Filter!</div>
                    <div class="code-block" draggable="true" data-type="pattern-feather">Spot Feather Pattern ‚û°Ô∏è Predict Flop!</div>
                    <div class="code-block" draggable="true" data-type="then-clean">Then Clean River Giggle!</div>
                </div>
                <div class="controls">
                    <button class="btn" onclick="runCodeSpell()">Run the Spell! ‚ú®</button>
                    <button class="btn" onclick="resetCodeCave()">Oopsie Reset</button>
                </div>
                <div id="code-message" style="margin-top: 15px; color: #ffff00; font-weight: bold;">Drag a block to start the wiggle!</div>
                <p style="font-size: 14px; color: #00ffff;">üí° Hooty Tip: Snap 3 blocks for full spell‚Äîdeductive zaps direct, inductive predicts the dragon's next puff!</p>
            </div>
            
            <div class="story-text">
                <p>As blocks snapped and spells ran, the cave lit up with clean-web visions: Rivers twinkling, fishies dancing, trees high-fiving birds. "See?" Hooty hooted. "Codes + reason = dragon-defying delight! No hard rules for the wiggly world‚Äîjust smart spells that grow with every giggle."</p>
                
                <div class="character-speech">
                    <strong>Little X:</strong> "My spell saved the feather flock! Coding is like magic science! What's next‚Äîcode a star race?"
                </div>
                
                <div class="character-speech guest-chat">
                    <strong>Keanu (appearing in pixel dust):</strong> "Beautiful coding, Little X. You've learned that programs are spells we cast to heal the world‚Äîflexible, reasoned, and always growing. Keep your heart pure and your code clean!"
                </div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn" onclick="loadChapter(2)" style="font-size: 18px; padding: 15px 30px;">
                    Continue to Chapter 2 ‚Üí
                </button>
            </div>
        </div>
        
        <div class="chapter" id="chapter2" style="display: none;">
            <h2>Chapter 2: Pattern Party Puzzle!</h2>
            
            <div class="story-text">
                <p>The code cave transformed into a swirling galaxy of patterns! Floating sequences of shapes, numbers, and colors danced through the air.</p>
                
                <div class="character-speech">
                    <strong>Twirly Logic Fairy ARIA:</strong> "Welcome to Pattern Party! Here we practice INDUCTIVE reasoning‚Äîspotting patterns to predict what comes next! It's how scientists discover new things and how coders debug their spells!"
                </div>
                
                <div class="character-speech">
                    <strong>Boomy Block Basher Raaarrr:</strong> "Raaarrr! I see triangles, triangles... SQUARE! Oopsie-pattern-break! Or is it the START of a new wiggle? That's the fun‚Äîtest your guess!"
                </div>
                
                <div class="character-speech">
                    <strong>Hooty Hacker Socrates:</strong> "Hooty-wisdom! Inductive reasoning is how we learned that pollution patterns harm fishies‚Äîspot the yuck, predict the hurt, CODE the fix! Not rigid rules, but flexible thinking!"
                </div>
            </div>
            
            <div class="chalkboard-container">
                <h3>üîÆ Pattern Prediction Challenge!</h3>
                <p>Watch the pattern, predict what comes next! 5 rounds, 20 seconds each!</p>
                
                <div id="pattern-display" style="font-size: 48px; min-height: 100px; display: flex; align-items: center; justify-content: center; gap: 15px; margin: 20px 0; background: rgba(0, 0, 0, 0.5); padding: 20px; border-radius: 10px;">
                    Click "Start Pattern Game" to begin!
                </div>
                
                <div id="pattern-timer" style="font-size: 24px; color: #00ffff; margin: 10px 0;">Ready to spot patterns?</div>
                
                <div class="instruments">
                    <button class="btn" onclick="startPatternGame()">üéÆ Start Pattern Game!</button>
                </div>
                
                <div id="pattern-choices" style="margin: 20px 0; display: none;">
                    <p style="color: #ffff00; font-size: 18px;">What comes next?</p>
                    <div class="instruments">
                        <button class="btn" onclick="guessPattern(0)">Choice A</button>
                        <button class="btn" onclick="guessPattern(1)">Choice B</button>
                        <button class="btn" onclick="guessPattern(2)">Choice C</button>
                    </div>
                </div>
                
                <div id="pattern-result" style="margin-top: 15px; padding: 15px; background: rgba(0, 255, 255, 0.2); border-radius: 10px; min-height: 50px; color: #00ff00; font-weight: bold;"></div>
                
                <div id="pattern-score" style="margin-top: 10px; font-size: 20px; color: #ff6b9d;">Score: 0/5</div>
            </div>
            
            <div class="story-text">
                <p>Little X spotted patterns like a coding wizard! "I predicted the next feather flop!" they cheered.</p>
                
                <div class="character-speech">
                    <strong>ARIA:</strong> "Perfect! That's INDUCTIVE reasoning‚Äîthe foundation of scientific discovery AND debugging code! When your spell doesn't work, you spot patterns in the errors and predict the fix!"
                </div>
                
                <div class="character-speech">
                    <strong>Raaarrr:</strong> "Raaarrr-smart! Pattern brain for the win! Now we're REALLY ready to outwit those smoky dragons with our flexy-thinking superpowers!"
                </div>
                
                <p style="text-align: center; font-size: 24px; color: #00ffff; text-shadow: 0 0 20px #00ffff; margin: 30px 0;">
                    <em>‚ú® The End of Book 4... Until Book 5: Justice for All! ‚ú®</em>
                </p>
            </div>
            
            <div class="nav-buttons">
                <button class="btn" onclick="loadChapter(1)" style="font-size: 18px; padding: 15px 30px;">
                    üîÑ Restart Book 4
                </button>
                <button class="btn" onclick="celebrateCompletion()" style="background: linear-gradient(45deg, #00ffff, #8a2be2, #ff6b9d); font-size: 18px; padding: 15px 30px;">
                    üéâ Celebrate!
                </button>
            </div>
        </div>
    </div>

    <script>
        let audioContext = null;
        function initAudio() {
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
            if (audioContext.state === 'suspended') audioContext.resume();
        }
        function playTone(freq, dur, type = 'sine') {
            initAudio();
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioContext.currentTime);
            gain.gain.setValueAtTime(0, audioContext.currentTime);
            gain.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + dur);
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + dur);
        }
        
        function createStars() {
            const container = document.getElementById('stars-container');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(star);
            }
        }
        
        // CODE CANVAS MAGIC
        let codeMode = '';
        let codeTimer;
        let timeLeft = 45;
        let draggedBlocks = [];
        let blockPositions = [];
        const codeCanvas = document.getElementById('code-canvas');
        const codeCtx = codeCanvas.getContext('2d');
        
        function drawCodeWeb() {
            codeCtx.clearRect(0, 0, 600, 400);
            const gradient = codeCtx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, '#000428');
            gradient.addColorStop(1, '#004e92');
            codeCtx.fillStyle = gradient;
            codeCtx.fillRect(0, 0, 600, 400);
            
            // River
            codeCtx.fillStyle = '#87CEEB';
            codeCtx.fillRect(0, 300, 600, 100);
            
            // Tree
            codeCtx.fillStyle = '#228B22';
            codeCtx.fillRect(100, 200, 50, 100);
            codeCtx.font = '40px Arial';
            codeCtx.fillText('üå≥', 95, 260);
            
            // Fish
            codeCtx.fillStyle = '#FF69B4';
            codeCtx.beginPath();
            codeCtx.arc(400, 350, 15, 0, Math.PI * 2);
            codeCtx.fill();
            codeCtx.fillText('üêü', 380, 360);
            
            // Pollution spots
            if (codeMode === 'deductive' && draggedBlocks.length < 2) {
                codeCtx.fillStyle = 'rgba(128, 128, 128, 0.6)';
                codeCtx.beginPath();
                codeCtx.arc(200, 320, 25, 0, Math.PI * 2);
                codeCtx.fill();
                codeCtx.fillStyle = '#fff';
                codeCtx.font = '20px Arial';
                codeCtx.fillText('üí®', 190, 328);
            } else if (codeMode === 'inductive' && draggedBlocks.length < 2) {
                codeCtx.font = '30px Arial';
                codeCtx.fillText('ü™∂', 250, 220);
                codeCtx.fillText('ü™∂', 300, 250);
                codeCtx.fillText('ü™∂', 350, 280);
                codeCtx.fillStyle = '#ffff00';
                codeCtx.font = '16px Arial';
                codeCtx.fillText('Pattern?', 380, 290);
            }
            
            // Snapped blocks
            blockPositions.forEach((pos, i) => {
                codeCtx.fillStyle = i < draggedBlocks.length ? '#00ff00' : '#ff6b9d';
                codeCtx.fillRect(pos.x, pos.y, 120, 40);
                codeCtx.fillStyle = '#000';
                codeCtx.font = 'bold 12px Arial';
                const text = draggedBlocks[i] || `Drop ${i + 1}`;
                codeCtx.fillText(text, pos.x + 10, pos.y + 25);
            });
        }
        
        // Drag-drop setup
        let draggedElement = null;
        document.querySelectorAll('.code-block').forEach(block => {
            block.addEventListener('dragstart', (e) => {
                draggedElement = e.target;
                e.dataTransfer.setData('text/plain', e.target.dataset.type);
            });
        });
        
        codeCanvas.addEventListener('dragover', (e) => e.preventDefault());
        codeCanvas.addEventListener('drop', (e) => {
            e.preventDefault();
            const type = e.dataTransfer.getData('text/plain');
            if (draggedBlocks.length < 3 && codeMode) {
                draggedBlocks.push(type);
                drawCodeWeb();
                document.getElementById('code-message').textContent = 
                    draggedBlocks.length === 3 ? 'Full spell! Run it! ‚ú®' : `${draggedBlocks.length}/3 blocks snapped!`;
                initAudio();
                playTone(523, 0.2, 'sine');
            }
        });
        
        function startCodeDash(mode) {
            codeMode = mode;
            timeLeft = 45;
            draggedBlocks = [];
            blockPositions = [
                {x: 50, y: 50},
                {x: 200, y: 50},
                {x: 350, y: 50}
            ];
            document.getElementById('code-timer').textContent = `Time: ${timeLeft}s ‚è∞`;
            document.getElementById('code-timer').style.color = '#ff6b9d';
            document.getElementById('code-message').textContent = 
                `${mode.toUpperCase()} MODE! ${mode === 'deductive' ? 'Snap rules to zap!' : 'Hunt patterns!'}`;
            drawCodeWeb();
            
            clearInterval(codeTimer);
            codeTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('code-timer').textContent = `Time: ${timeLeft}s ‚è∞`;
                if (timeLeft <= 10) document.getElementById('code-timer').style.color = '#ff0000';
                if (timeLeft <= 0) {
                    clearInterval(codeTimer);
                    document.getElementById('code-message').textContent = 'Time up! Reset for another try!';
                    initAudio();
                    playTone(392, 0.3, 'square');
                }
            }, 1000);
            
            initAudio();
            playTone(659, 0.3, 'sine');
        }
        
        function runCodeSpell() {
            if (draggedBlocks.length < 3 || timeLeft <= 0 || !codeMode) {
                document.getElementById('code-message').textContent = 'Need 3 blocks, time, and mode!';
                return;
            }
            clearInterval(codeTimer);
            
            let animStep = 0;
            const spellAnim = setInterval(() => {
                drawCodeWeb();
                
                if (codeMode === 'deductive') {
                    codeCtx.fillStyle = `rgba(0, 255, 0, ${0.3 + animStep * 0.07})`;
                    codeCtx.beginPath();
                    codeCtx.arc(200, 320, 25 + animStep * 3, 0, Math.PI * 2);
                    codeCtx.fill();
                } else {
                    codeCtx.font = '30px Arial';
                    codeCtx.fillStyle = '#00ff00';
                    codeCtx.fillText('ü™∂', 400, 250 + animStep * 5);
                }
                
                animStep++;
                if (animStep > 10) {
                    clearInterval(spellAnim);
                    document.getElementById('code-message').textContent = 
                        `‚ú® SPELL SUCCESS! ${codeMode === 'deductive' ? 'Puff zapped!' : 'Pattern predicted!'} Web heroes unite! ‚ú®`;
                    initAudio();
                    playTone(880, 0.5, 'sine');
                    
                    for (let i = 0; i < 15; i++) {
                        setTimeout(() => {
                            const sparkle = document.createElement('div');
                            sparkle.textContent = ['‚≠ê', '‚ú®', 'üí´'][Math.floor(Math.random() * 3)];
                            sparkle.style.cssText = `position: absolute; font-size: ${20 + Math.random() * 20}px; 
                                color: #${['00ffff', 'ff6b9d', '00ff00'][Math.floor(Math.random() * 3)]}; 
                                left: ${Math.random() * 600}px; top: ${Math.random() * 400}px; 
                                animation: float-up 1.5s ease-out forwards; pointer-events: none; z-index: 100;`;
                            codeCanvas.parentElement.appendChild(sparkle);
                            setTimeout(() => sparkle.remove(), 1500);
                        }, i * 80);
                    }
                }
            }, 150);
        }
        
        function resetCodeCave() {
            clearInterval(codeTimer);
            timeLeft = 45;
            draggedBlocks = [];
            blockPositions = [];
            codeMode = '';
            document.getElementById('code-timer').style.color = '#ff6b9d';
            document.getElementById('code-timer').textContent = 'Time: 45s ‚è∞ ‚Äì Pick a mode!';
            document.getElementById('code-message').textContent = 'Cave reset! Pick a mode to start!';
            drawCodeWeb();
        }
        
        // PATTERN GAME
        let patternRound = 0;
        let patternScore = 0;
        let patternTimer;
        let patternTimeLeft = 20;
        let currentPattern = null;
        
        const patterns = [
            {
                sequence: ['üî∫', 'üî∫', 'üî¥', 'üî∫', 'üî∫', 'üî¥'],
                choices: ['üî∫', 'üî¥', '‚¨ú'],
                answer: 0,
                hint: "Two triangles, then circle repeats!"
            },
            {
                sequence: ['1Ô∏è‚É£', '2Ô∏è‚É£', '3Ô∏è‚É£', '2Ô∏è‚É£', '3Ô∏è‚É£', '4Ô∏è‚É£'],
                choices: ['3Ô∏è‚É£', '4Ô∏è‚É£', '5Ô∏è‚É£'],
                answer: 0,
                hint: "Numbers climb then repeat!"
            },
            {
                sequence: ['üåü', '‚≠ê', 'üåü', '‚≠ê', 'üåü'],
                choices: ['üåü', '‚≠ê', 'üí´'],
                answer: 1,
                hint: "Alternating stars!"
            },
            {
                sequence: ['üü¶', 'üü¶', 'üü©', 'üü©', 'üü©', 'üü¶'],
                choices: ['üü©', 'üü¶', 'üü•'],
                answer: 1,
                hint: "Pattern shifts!"
            },
            {
                sequence: ['üçé', 'üçé', 'üçå', 'üçé', 'üçé', 'üçå'],
                choices: ['üçé', 'üçå', 'üçì'],
                answer: 0,
                hint: "Fruit pattern repeats!"
            }
        ];
        
        function startPatternGame() {
            patternRound = 0;
            patternScore = 0;
            document.getElementById('pattern-score').textContent = 'Score: 0/5';
            showNextPattern();
        }
        
        function showNextPattern() {
            if (patternRound >= 5) {
                endPatternGame();
                return;
            }
            
            currentPattern = patterns[patternRound];
            const display = document.getElementById('pattern-display');
            display.innerHTML = currentPattern.sequence.join(' ');
            
            patternTimeLeft = 20;
            document.getElementById('pattern-timer').textContent = `‚è∞ ${patternTimeLeft}s - Spot the pattern!`;
            document.getElementById('pattern-timer').style.color = '#00ffff';
            
            clearInterval(patternTimer);
            patternTimer = setInterval(() => {
                patternTimeLeft--;
                document.getElementById('pattern-timer').textContent = `‚è∞ ${patternTimeLeft}s`;
                if (patternTimeLeft <= 5) {
                    document.getElementById('pattern-timer').style.color = '#ff0000';
                    initAudio();
                    playTone(440, 0.1, 'square');
                }
                if (patternTimeLeft <= 0) {
                    clearInterval(patternTimer);
                    document.getElementById('pattern-result').textContent = '‚è∞ Time up! Next pattern...';
                    setTimeout(showNextPattern, 1500);
                }
            }, 1000);
            
            document.getElementById('pattern-choices').style.display = 'block';
            const choiceBtns = document.querySelectorAll('#pattern-choices .btn');
            currentPattern.choices.forEach((choice, i) => {
                choiceBtns[i].textContent = choice;
            });
            
            document.getElementById('pattern-result').textContent = `Hint: ${currentPattern.hint}`;
            
            initAudio();
            playTone(523, 0.3, 'sine');
        }
        
        function guessPattern(choiceIndex) {
            clearInterval(patternTimer);
            
            const result = document.getElementById('pattern-result');
            if (choiceIndex === currentPattern.answer) {
                patternScore++;
                result.textContent = `‚úÖ CORRECT! Pattern spotted! (${currentPattern.hint})`;
                result.style.background = 'rgba(0, 255, 0, 0.3)';
                initAudio();
                playTone(659, 0.3, 'sine');
                setTimeout(() => playTone(784, 0.3, 'sine'), 150);
            } else {
                result.textContent = `‚ùå Not quite! The pattern was: ${currentPattern.hint}`;
                result.style.background = 'rgba(255, 107, 157, 0.3)';
                initAudio();
                playTone(349, 0.4, 'square');
            }
            
            document.getElementById('pattern-score').textContent = `Score: ${patternScore}/${patternRound + 1}`;
            
            patternRound++;
            setTimeout(showNextPattern, 2000);
        }
        
        function endPatternGame() {
            clearInterval(patternTimer);
            document.getElementById('pattern-choices').style.display = 'none';
            document.getElementById('pattern-timer').textContent = 'üéâ Game Complete!';
            
            const result = document.getElementById('pattern-result');
            if (patternScore >= 4) {
                result.innerHTML = `üåü AMAZING! ${patternScore}/5 - Pattern Master! üåü<br>You've mastered INDUCTIVE reasoning!`;
                result.style.background = 'rgba(0, 255, 0, 0.3)';
            } else if (patternScore >= 3) {
                result.innerHTML = `‚ú® Great work! ${patternScore}/5 - Pattern Spotter! ‚ú®`;
                result.style.background = 'rgba(0, 255, 255, 0.3)';
            } else {
                result.innerHTML = `üí´ Good try! ${patternScore}/5 - Practice makes perfect!`;
                result.style.background = 'rgba(138, 43, 226, 0.3)';
            }
            
            document.getElementById('pattern-display').textContent = 'üéÆ Click "Start Pattern Game" to play again!';
            
            initAudio();
            for (let i = 0; i < 5; i++) {
                setTimeout(() => playTone(523 + i * 100, 0.2, 'sine'), i * 150);
            }
        }
        
        function loadChapter(num) {
            document.querySelectorAll('.chapter').forEach(ch => ch.style.display = 'none');
            const target = num === 1 ? document.querySelector('.chapter') : document.getElementById('chapter' + num);
            if (target) {
                target.style.display = 'block';
                window.scrollTo(0, 0);
            }
            if (num === 1) {
                setTimeout(() => {
                    resetCodeCave();
                    drawCodeWeb();
                }, 100);
            }
        }
        
        function celebrateCompletion() {
            initAudio();
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    playTone(523 + Math.random() * 400, 0.3, 'sine');
                    const fw = document.createElement('div');
                    fw.textContent = ['üéâ', '‚ú®', 'üíª', 'üîÆ'][Math.floor(Math.random() * 4)];
                    fw.style.cssText = `position: fixed; left: ${Math.random() * innerWidth}px; 
                        top: ${Math.random() * innerHeight}px; font-size: ${30 + Math.random() * 30}px; 
                        animation: float-up 2s ease-out forwards; pointer-events: none; z-index: 9999;`;
                    document.body.appendChild(fw);
                    setTimeout(() => fw.remove(), 2000);
                }, i * 150);
            }
            setTimeout(() => alert('üéâ BOOK 4 COMPLETE! üéâ\n\nYou learned:\nüíª Coding with blocks\nüî¨ Deductive reasoning\nüîÆ Inductive patterns\nüåç Environmental coding\n\nReady for Book 5: Justice for All!'), 2000);
        }
        
        window.addEventListener('DOMContentLoaded', () => {
            createStars();
            drawCodeWeb();
        });
    </script>
    
    <!-- Resources Section -->
    <div class="chapter" style="background: rgba(138, 43, 226, 0.3); text-align: center; border: 3px solid #ff6b9d;">
        <h2>üìö Resources for Parents & Teachers</h2>
        <p style="font-size: 1.2em; margin: 20px 0; color: #ffff00;">
            Download comprehensive guides to enhance your Little X learning experience!
        </p>
        <div style="margin: 30px 0; display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;">
            <a href="little-x-complete-handbook.pdf" download class="btn" style="display: inline-block; text-decoration: none; font-size: 18px; padding: 15px 25px;">
                üìñ Complete Handbook
            </a>
            <a href="guides-little-x.pdf" download class="btn" style="display: inline-block; text-decoration: none; font-size: 18px; padding: 15px 25px;">
                üìã Guides Overview
            </a>
            <a href="little-x-deployment-guide.pdf" download class="btn" style="display: inline-block; text-decoration: none; font-size: 18px; padding: 15px 25px;">
                üöÄ Deployment Guide
            </a>
            <a href="little-x-series-faq.pdf" download class="btn" style="display: inline-block; text-decoration: none; font-size: 18px; padding: 15px 25px;">
                ‚ùì Series FAQ
            </a>
            <a href="little-x-resources-links.pdf" download class="btn" style="display: inline-block; text-decoration: none; font-size: 18px; padding: 15px 25px;">
                üîó Resources & Links
            </a>
        </div>
        <p style="font-size: 14px; color: #8a2be2; margin-top: 20px;">
            ‚ú® These guides work across the entire Little X series! ‚ú®
        </p>
    </div>
    
    <!-- Audio Narration System -->
    <script src="https://coldnsteel.github.io/GMSRFC/little-x-audio-narration.js"></script>

</body>
</html>
